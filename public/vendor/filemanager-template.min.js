!function(){"use strict";var e,t;window.fmWrapper=document.querySelector(".fm-wrapper"),Element.prototype.closest||((e=Element.prototype).matches||(e.matches=e.msMatchesSelector||e.webkitMatchesSelector),e.closest=function(e){var t=this;if(t.matches(e))return t;for(;t.parentElement;){var r=t.parentElement;if(r.matches(e))return r;t=t.parentElement}}),NodeList.prototype.forEach||(NodeList.prototype.forEach=function(e,t){for(var r=0;r<this.length;r++)e.call(t,this[r],r,this)}),"classList"in HTMLElement.prototype&&!("forEach"in document.createElement("_").classList)&&(DOMTokenList.prototype.forEach=function(e,t){for(var r=0;r<this.length;r++)e.call(t,this[r],r,this)}),"classList"in document.createElement("_")||((t=function(e){e.className.split(" ").forEach(function(e){this.push(e)}.bind(this)),this._update=function(){e.setAttribute("class",this.join(" "))}}).prototype=Array.prototype,classListProto=t.prototype,classListProto.add=function(){for(var e=0;e<arguments.length;e++)this.contains(arguments[e])||this.push(arguments[e]);this._update()},classListProto.remove=function(){for(var e=0;e<arguments.length;e++)for(var t=0;t<this.length;t++)this[t]===arguments[e]&&this.splice(t,1);this._update()},classListProto.item=function(e){return this[e]},classListProto.contains=function(e){return-1!==this.indexOf(e)},classListProto.toggle=function(e){this.contains(e)?this.remove(e):this.add(e)},Object.defineProperty(window.Element.prototype,"classList",{get:function(){return new t(this)},enumerable:!0,configurable:!0}));var o=[0,0,0],n={read:4,write:2,execute:1};function r(e){var t,r=fmWrapper.querySelector(".theme-option[data-theme="+e+"]");r&&(fmWrapper.querySelectorAll(".theme-option").forEach(function(e){e.classList.remove("selected")}),r.classList.add("selected"),t=[],fmWrapper.querySelectorAll(".theme-option").forEach(function(e){t.push(e.getAttribute("data-theme"))}),fmWrapper.classList.forEach(function(e){t.forEach(function(e){fmWrapper.classList.remove(e)})}),fmWrapper.classList.add(e),localStorage.setItem("fm-theme",e))}fmWrapper.querySelectorAll(".perm-table .checkbox").forEach(function(e){e.addEventListener("change",function(){fmWrapper.querySelector(".numeric-chmod").textContent=function(){var e=this.getAttribute("data-group"),t=this.getAttribute("data-action"),r=this.querySelector('input[type="checkbox"]').checked;switch(e){case"owner":r?o[0]+=n[t]:o[0]-=n[t];break;case"group":r?o[1]+=n[t]:o[1]-=n[t];break;case"others":r?o[2]+=n[t]:o[2]-=n[t]}return"0"+o.join("")}.call(this)})}),localStorage.getItem("fm-theme")&&r(localStorage.getItem("fm-theme")),fmWrapper.querySelectorAll(".theme-option").forEach(function(e){e.addEventListener("click",function(){r(this.getAttribute("data-theme"))})}),window.addEventListener("DOMContentLoaded",function(){fmWrapper.querySelectorAll(".loading").forEach(function(e){e.classList.remove("loading")})});var a=fmWrapper.querySelector("#fm-editor"),c=a.querySelector(".line-numbers"),i=a.querySelector(".content-area");function l(){var e=i.value.split("\n").length;c.innerHTML="";for(var t,r,o=0;o<e;o++)t=o+1,r=void 0,(r=document.createElement("span")).textContent=t,c.appendChild(r);i.style.height=window.getComputedStyle(c).getPropertyValue("height")}["input","paste"].forEach(function(e){i.addEventListener(e,l)});function s(e,r,o){document.addEventListener(e,function(e){e.target.matches(r)&&o(e);for(var t=e.target.parentElement;null!==t;)t.matches(r)&&o(e),t=t.parentElement})}l(),window.fmEditor=new function(){this.set=function(e){i.value=e,l()},this.append=function(e){i.value+=e,l()},this.get=function(){return i.value},this.clear=function(){i.value="",l()}},fmWrapper.querySelector(".toggle-slidebar").addEventListener("click",function(){document.querySelector(".slidebar").classList.toggle("show")}),fmWrapper.addEventListener("click",function(e){(e.target.closest(".slidebar")||e.target.closest(".toggle-slidebar")||e.target.closest(".settings-modal")||e.target.closest(".modal-overlay"))&&!e.target.closest('.settings-modal button[data-close="modal"]')||fmWrapper.querySelector(".slidebar").classList.remove("show")});var f=fmWrapper.querySelector(".files-table"),u=f.querySelector(".files-select-all"),d=fmWrapper.querySelector(".toolbar .files-select"),m=fmWrapper.querySelector(".toolbar .files-unselect"),p=fmWrapper.querySelectorAll(".right-buttons *[data-action]");function h(){return f.querySelectorAll(".file-item")}function y(){return f.querySelectorAll(".file-item.selected")}function v(){return f.querySelectorAll('.file-item .checkbox input[type="checkbox"]')}function g(t){var e=v();u.checked=t,[].forEach.call(e,function(e){e.checked=t,e.closest(".file-item").classList[t?"add":"remove"]("selected")})}function E(t,r){var o={file:[],dir:["edit","download"],all:["edit","rename","move","download","permissions","info"]};p.forEach(function(e){r&&-1!==o[r].indexOf(e.getAttribute("data-action"))?e.disabled=!0:e.disabled=!t})}function S(){var e=y(),t=h();u.checked=t.length===e.length}s("click",".file-item",function(e){var t,r,o;e.target.closest(".checkbox")||(e.shiftKey||e.ctrlKey||(t=y(),r=v(),t.forEach(function(e){e.classList.remove("selected")}),r.forEach(function(e){e.checked=!1})),u.checked=!1,(o=e.target.closest(".file-item")).classList.add("selected"),E(o.querySelector('.checkbox input[type="checkbox"]').checked=!0,o.closest(".file-item").getAttribute("data-type")),S())}),s("change",'.file-item .checkbox input[type="checkbox"]',function(e){e.target.closest(".file-item").classList.toggle("selected");var t=y();1<t.length?E(!0,"all"):1===t.length?E(!0,t[0].getAttribute("data-type")):E(!1),S()}),u.addEventListener("change",function(){this.checked?(g(!0),E(!0,"all")):(g(!1),E(!1))}),d.addEventListener("click",function(){g(!0),E(!0,"all")}),m.addEventListener("click",function(){g(!1),E(!1)}),fmWrapper.addEventListener("click",function(e){(e.target.closest(".files-table")||e.target.closest(".files-select")||e.target.closest(".files-unselect")||e.target.closest(".footer")||e.target.closest(".modal"))&&!e.target.closest('*[data-close="modal"]')||(g(!1),E(!1),S())}),window.addEventListener("keyup",function(e){var t,r,o,n,a="Up"===e.key||"ArrowUp"===e.key,c="Down"===e.key||"ArrowDown"===e.key,i=h();!a&&!c||fmWrapper.querySelector(".modal.show")||(1<=(t=function(){for(var e=h(),t=fmWrapper.querySelector(".files-table .file-item.selected"),r=0;r<e.length;r++)if(e[r]===t)return r+1;return-1}())&&t!==i.length&&c?t++:1<t&&a?t--:t=1===t&&a?i.length:1,g(!1),r=t,o=fmWrapper.querySelector(".files-table .file-item:nth-child("+r+")"),n=o.querySelector('.checkbox input[type="checkbox"]'),E(!0,o.getAttribute("data-type")),o.classList.add("selected"),n.checked=!0)});var L=document.createElement("div");L.classList.add("modal-overlay"),fmWrapper.appendChild(L),fmWrapper.querySelectorAll("*[data-modal]").forEach(function(e){e.addEventListener("click",function(){fmWrapper.querySelector(this.getAttribute("data-modal")).classList.add("show"),L.classList.add("show")})}),fmWrapper.querySelectorAll('*[data-close="modal"]').forEach(function(e){e.addEventListener("click",function(){this.closest(".modal").classList.remove("show"),L.classList.remove("show")})});var q=fmWrapper.querySelector("#moveFileModal"),b=q.querySelectorAll(".files-list .item");b.forEach(function(e){e.addEventListener("click",function(t){[function(e){this===e.target.closest(".dir-item")&&(b.forEach(function(e){e.classList.remove("selected")}),this.classList.add("selected"))},function(e){var t=q.querySelector(".destination");if(this===e.target.closest(".dir-item")){var r=this,o=r.querySelector(".name").textContent;for(r=r.parentElement.parentElement;r.classList.contains("dir-item");)o=r.querySelector(".name").textContent+"/"+o,r=r.parentElement.parentElement;t.textContent=o}}].forEach(function(e){e.call(this,t)}.bind(this))})}),fmWrapper.querySelector('*[data-action="move"]').addEventListener("click",function(){var e;e=fmWrapper.querySelector(".files-table .file-item.selected .file-name"),fmWrapper.querySelector("#moveFileModal .moving-to .source").textContent=e.textContent}),fmWrapper.querySelector('*[data-action="remove"]').addEventListener("click",function(){var e=fmWrapper.querySelectorAll(".files-table .file-item.selected"),t=fmWrapper.querySelector("#removeFileModal .filename");1===e.length?t.textContent=e[0].querySelector(".file-name").textContent:t.textContent="("+e.length+") files"}),fmWrapper.querySelector('*[data-action="rename"]').addEventListener("click",function(){var e=fmWrapper.querySelector(".files-table .file-item.selected");fmWrapper.querySelector("#renameFileModal .name-for").textContent=e.querySelector(".file-name").textContent}),fmWrapper.querySelector('*[data-action="permissions"]').addEventListener("click",function(){var e=fmWrapper.querySelector(".files-table .file-item.selected");fmWrapper.querySelector("#permissionsModal .filename").textContent=e.querySelector(".file-name").textContent})}();
